/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	var __webpack_modules__ = ({

/***/ "./src/js/WDPAutomator.js":
/*!********************************!*\
  !*** ./src/js/WDPAutomator.js ***!
  \********************************/
/***/ (() => {

eval("let DataTable;\r\nlet obStatus;\r\nlet aggregateId;\r\n\r\nfunction find_str(array) {\r\n\tfor (var i = 0; i < array.length; i++) {\r\n\t\tif (array[i][0].includes(\"idToken\")) {\r\n\t\t\treturn array[i][1];\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction WDPAutomator(elem) {\r\n\t$.getScript(chrome.runtime.getURL('js/External/dataTables.select.min.js'))\r\n\tvar obligation1;\r\n\tvar addExternalInfrigementsButton = elem;\r\n\taddInfringementsFromViewButton = ViewButton(addExternalInfrigementsButton)\r\n\t$('body').append('<script id=\"script\">$(document).ready(function(){$(\\'[data-toggle=\\\"tooltip\\\"]\\').tooltip(); }); <' + '/' + 'script>');\r\n\taddInfringementsFromViewButton.addEventListener(\"click\", function () {\r\n\t\tlet obligations = [];\r\n\r\n\t\t// Check if the element with id \"obligationNumber1\" exists\r\n\t\tconst obligationNumber1 = document.getElementById(\"obligationNumber1\");\r\n\r\n\t\tif (obligationNumber1) {\r\n\t\t\t// If it exists, get its value\r\n\t\t\tobligations.push(document.getElementById(\"obligationNumber1\").value);\r\n\t\t\tobligations.push(document.getElementById(\"obligationNumber2\").getAttribute(\"ng-reflect-model\"));\r\n\t\t\tobligations.push(document.getElementById(\"obligationNumber3\").getAttribute(\"ng-reflect-model\"));\r\n\t\t} else {\r\n\t\t\t// If it doesn't exist, get the value of the element with id \"notes\"\r\n\r\n\t\t\tconst notesValue = document.querySelector(\"#notes\").value;\r\n\t\t\tif (notesValue.length !== 10 || !/^\\d+$/.test(notesValue)) {\r\n\t\t\t\talert('Obligation number stored in note field must be exactly 10 characters long and contain only numbers.');\r\n\t\t\t}\r\n\t\t\tobligations.push(notesValue);\r\n\t\t}\r\n\r\n\t\tlet message = { \"type\": \"Initialise\", \"data\": obligations }\r\n\t\t$(\"#table\").html(`<div class=\"lds-ring\"><div></div><div></div><div></div><div></div></div>`)\r\n\t\tchrome.runtime.sendMessage(message, function (response) { console.log(response); response.payload !== false ? convertToHTMLTable(response.payload) : $(\"#table\").html(\"Obligation not found. Please make sure that you are logged into VIEW and that you have you have typed a valid obligation number into the 'Obligation number 1' field\") });\r\n\t});\r\n}\r\n\r\nfunction clean() {\r\n\tdocument.getElementById(\"script\").parentNode.removeChild(document.getElementById(\"script\"))\r\n\t//document.getElementById(\"ViewButton\").parentNode.removeChild(document.getElementById(\"ViewButton\"))\r\n\t//document.getElementById(\"exampleModal\").parentNode.removeChild(document.getElementById(\"exampleModal\"))\r\n}\r\n\r\nfunction ViewButton(addExternalInfrigementsButton) {\r\n\tlet addInfringementsFromViewButton = document.createElement(\"button\");\r\n\tlet modalWrap = document.createElement(\"span\");\r\n\tmodalWrap.setAttribute(\"data-toggle\", \"modal\")\r\n\tmodalWrap.setAttribute(\"data-target\", \"#exampleModal\")\r\n\taddInfringementsFromViewButton.className = \"btn btn-primary pull-left\";\r\n\taddInfringementsFromViewButton.id = \"ViewButton\"\r\n\taddInfringementsFromViewButton.textContent = \"Show obligations from VIEW\"\r\n\taddInfringementsFromViewButton.setAttribute(\"data-toggle\", \"tooltip\")\r\n\taddInfringementsFromViewButton.setAttribute(\"title\", \"Caution: Using this feature may change your active debtor and obligation in VIEW\")\r\n\tmodalWrap.appendChild(addInfringementsFromViewButton)\r\n\tconst button = addExternalInfrigementsButton.querySelector('button')\r\n\tbutton.parentNode.insertBefore(modalWrap, button.nextSibling);\r\n\t// addExternalInfrigementsButton.parentNode.lastChild.previousSibling.previousSibling.previousSibling.firstChild.nextSibling.appendChild(modalWrap)\r\n\treturn addInfringementsFromViewButton\r\n}\r\n\r\nfunction addModal() {\r\n\tlet modal = `\r\n\t\t<div class=\"modal fade\" id=\"exampleModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"exampleModalLabel\" aria-hidden=\"true\">\r\n  <div class=\"modal-dialog\" role=\"document\">\r\n    <div class=\"modal-content\">\r\n      <div class=\"modal-header\">\r\n        <h5 class=\"modal-title\" id=\"exampleModalLabel\">Obligations from VIEW</h5>\r\n        <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n          <span aria-hidden=\"true\">&times;</span>\r\n        </button>\r\n      </div>\r\n      <div class=\"modal-body\">\r\n\t\t<div id=\"table\">\r\n\t\t\r\n\t\t</div>\r\n      </div>\r\n      <div class=\"modal-footer\">\r\n        <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Close</button>\r\n        <button id=\"submit\" type=\"button\" class=\"btn btn-primary\" data-dismiss=\"modal\">Add to WDP</button>\r\n\t\t<button type=\"button\" class=\"btn btn-primary\">Place Holds</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n\t`\r\n\tmodal = $.parseHTML(modal)\r\n\t$('body').prepend(modal);\r\n}\r\nfunction convertToHTMLTable(rows) {\r\n\tvar html = '<table id=\"example\" class=\"table table-striped table-bordered\" style=\"width:100%\">';\r\n\thtml += '<thead><tr>';\r\n\tfor (var j in rows[0]) {\r\n\t\thtml += '<th>' + j + '</th>';\r\n\t}\r\n\thtml += '</tr></thead>';\r\n\tfor (var i = 0; i < rows.length; i++) {\r\n\t\thtml += '<tr>';\r\n\t\tfor (var j in rows[i]) {\r\n\t\t\thtml += '<td>' + rows[i][j] + '</td>';\r\n\t\t}\r\n\t\thtml += '</tr>';\r\n\t}\r\n\thtml += '</table>';\r\n\tdocument.getElementById('table').innerHTML = html;\r\n\tDataTable = $(\"#example\").DataTable({\r\n\t\t\"dom\": 'Blfrtip',\r\n\t\t\"ordering\": true,\r\n\t\t\"paging\": false,\r\n\t\t\"select\": {\r\n\t\t\t\"style\": \"multi\"\r\n\t\t},\r\n\t\t\"buttons\": [\r\n\t\t\t\"selectAll\",\r\n\t\t\t\"selectNone\"\r\n\t\t],\r\n\t\t\"language\": {\r\n\t\t\t\"buttons\": {\r\n\t\t\t\t\"selectAll\": \"Select all items\",\r\n\t\t\t\t\"selectNone\": \"Select none\"\r\n\t\t\t}\r\n\t\t}\r\n\t})\r\n}\r\n\r\n$(document).ready(function () {\r\n\tvar $app = $(\"body\");\r\n\taddModal()\r\n\t$app.livequery(\"div:contains(Add external infringements)\", function (elem) { WDPAutomator(elem) }, function () { clean() });\r\n\r\n\tdocument.getElementById(\"submit\").addEventListener(\"click\", function () {\r\n\t\t//Get the current WDP application from the page and store in aggregateId global variable\r\n\t\taggregateId = parseInt($(\"[for=WDPApplicationId]\")[0].parentNode.textContent.match(/[^-]+$/)[0].replace(/\\s/g, ''))\r\n\r\n\t\tlet currentWDPInfringements = getCurrentWDPInfringements(aggregateId)\r\n\t\tlet data = DataTable.rows({ selected: true }).data();\r\n\t\tif (data.length === 0) {\r\n\t\t\talert(\"You must select at least one obligation\");\r\n\t\t\tthrow \"No Obligations Selected\";\r\n\t\t}\r\n\t\tlet obligations = []\r\n\t\tobStatus = []\r\n\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\tobligations.push(data[i][0]);\r\n\t\t\tobStatus[data[i][0]] = data[i][3]\r\n\t\t}\r\n\t\tlet message = { \"type\": \"Scrape\", \"data\": obligations }\r\n\t\twaitingDialog.show('Getting obligation data from VIEW');\r\n\t\t$(\"#prog\").addClass(\"in\");\r\n\t\twaitingDialog.progress(0);\r\n\t\tchrome.runtime.sendMessage(message, async function (response) {\r\n\t\t\twaitingDialog.hide();\r\n\t\t\tvar i, j, temparray, chunk = 15;\r\n\t\t\tlet r = 0;\r\n\t\t\tlet array = response.payload.a\r\n\t\t\tcurrentWDPInfringements = await currentWDPInfringements;\r\n\t\t\tarray = array.filter(obl => { return !currentWDPInfringements.includes(obl.Infringement) })\r\n\t\t\tconsole.log(array);\r\n\t\t\tlet slicedArray = []\r\n\t\t\tfor (i = 0, j = array.length; i < j; i += chunk) {\r\n\t\t\t\tslicedArray.push(array.slice(i, i + chunk));\r\n\t\t\t}\r\n\t\t\tbatchRequests(slicedArray, response.payload, obStatus).then(res => {\r\n\t\t\t\tconst selectedApplication = `WDP-${aggregateId}`\r\n\t\t\t\tvar $app = $(\"body\");\r\n\t\t\t\t// Get all buttons on the page\r\n\t\t\t\t$app.livequery(\"button:contains(Save)\", function (elem) {\r\n\t\t\t\t\telem.click();\r\n\t\t\t\t})\r\n\t\t\t\t$app.livequery(\"#content > app-root > div > app-approved-wdp > div:nth-child(2) > div > div > a\", function (elem) {\r\n\t\t\t\t\telem.click();\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// Select the target node\r\n\t\t\t\tconst targetNode = document.documentElement; // You can choose a more specific target if needed\r\n\r\n\t\t\t\t// Options for the observer (in this case, we want to observe the addition of nodes)\r\n\t\t\t\tconst config = { childList: true, subtree: true };\r\n\r\n\t\t\t\t// Callback function to execute when mutations are observed\r\n\t\t\t\tconst callback = function (mutationsList, observer) {\r\n\t\t\t\t\tfor (const mutation of mutationsList) {\r\n\t\t\t\t\t\tif (mutation.type === 'childList') {\r\n\t\t\t\t\t\t\t// Check if nodes were added\r\n\t\t\t\t\t\t\tif (mutation.addedNodes.length > 0) {\r\n\t\t\t\t\t\t\t\t// Check if any of the added nodes has the ID 'global_filter'\r\n\t\t\t\t\t\t\t\tconst addedNodesArray = Array.from(mutation.addedNodes);\r\n\t\t\t\t\t\t\t\tconst filteredNodesArray = addedNodesArray.filter(node => typeof node.id === 'string' && node.id !== '')\r\n\t\t\t\t\t\t\t\tconst globalFilterAdded = filteredNodesArray.some(node => node.id === 'wdps-data-table')\r\n\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\tobserver.disconnect();\r\n\t\t\t\t\t\t\t\t}, 8000); // 5000 milliseconds (5 seconds)\r\n\r\n\t\t\t\t\t\t\t\tif (globalFilterAdded) {\r\n\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\tconst globalFilter = document.getElementById('global_filter')\r\n\t\t\t\t\t\t\t\t\t\tglobalFilter.value = selectedApplication;\r\n\t\t\t\t\t\t\t\t\t\tglobalFilter.click();\r\n\t\t\t\t\t\t\t\t\t\t$('button:contains(\"View\")').click();\r\n\t\t\t\t\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\t\t\t\t\t// Handle errors\r\n\t\t\t\t\t\t\t\t\t\tconsole.error('Error:', error.message);\r\n\t\t\t\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\t\t\t\t// Disconnect the observer in the finally block\r\n\t\t\t\t\t\t\t\t\t\tobserver.disconnect();\r\n\t\t\t\t\t\t\t\t\t\t//console.log('Observer disconnected');\r\n\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t// Disconnect the observer to stop further observations\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Create a new obsersver with the specified callback and options\r\n\t\t\t\tconst observer = new MutationObserver(callback);\r\n\r\n\t\t\t\t// Start observing the target node for configured mutations\r\n\t\t\t\tobserver.observe(targetNode, config);\r\n\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n})\r\n\r\nfunction selectApplication(searchbar) {\r\n\tvar $app = $(\"body\");\r\n\tsearchbar.value = \"WDP-127\"\r\n\tsearchbar.focus();\r\n}\r\n\r\n\r\n\r\n\r\nfunction submitToWDP(obdata, fulldata, obStatus) {\r\n\tconsole.log(obdata)\r\n\tlet date = new Date();\r\n\tlet dateISO = date.toISOString();\r\n\tlet FillerDate\r\n\tlet DateofIssue = new Date();\r\n\tlet DateofBirth = new Date();\r\n\r\n\tif (obdata[\"Date of Issue\"] !== \"\") {\r\n\t\tDateofIssue = obdata[\"Date of Issue\"].split(\"/\")\r\n\t\tDateofIssue = new Date(+DateofIssue[2], DateofIssue[1] - 1, +DateofIssue[0]).toISOString();\r\n\t}\r\n\r\n\tif (obdata[\"Date_of_Birth\"] !== \"\") {\r\n\t\tDateofBirth = obdata[\"Date_of_Birth\"].split(\"/\")\r\n\t\tDateofBirth = new Date(+DateofBirth[2], DateofBirth[1] - 1, +DateofBirth[0]).toISOString();\r\n\t}\r\n\r\n\tlet DateofOffence = \"\"\r\n\tif (obdata[\"Date_of_Offence\"] !== \"\") {\r\n\t\tif (obdata[\"Offence Time\"] !== \"\") {\r\n\t\t\tDateofOffence = obdata[\"Date_of_Offence\"].split(\"/\").concat(obdata[\"Offence Time\"].split(\":\"))\r\n\t\t\tDateofOffence = new Date(DateofOffence[2], DateofOffence[1] - 1, +DateofOffence[0], +DateofOffence[3], +DateofOffence[4], +DateofOffence[5])\r\n\t\t\tFillerDate = new Date(DateofOffence);\r\n\t\t\tDateofOffence.toISOString();\r\n\t\t} else {\r\n\t\t\tDateofOffence = obdata[\"Date_of_Offence\"].split(\"/\")\r\n\t\t\tDateofOffence = new Date(DateofOffence[2], DateofOffence[1] - 1, +DateofOffence[0]);\r\n\t\t\tFillerDate = new Date(DateofOffence);\r\n\t\t\tDateofOffence = DateofOffence.toISOString();\r\n\t\t}\r\n\t}\r\n\r\n\tif (obdata[\"Date of Issue\"] === \"\") {\r\n\t\tDateofIssue.setHours(FillerDate.getHours() - 1)\r\n\t\tDateofIssue.toISOString();\r\n\t}\r\n\r\n\tlet Obligation = obdata.Obligation\r\n\r\n\tconst isVariationPresent = window.location.href.includes('/wdp-applications/variation');\r\n\r\n\tconst commandType = isVariationPresent ? 'addObligationToWDPVariationCommand' : 'addExternalEnforcementAgenciesObligationCommand'\r\n\tconst sequence = isVariationPresent ? 'obligation' : 'externalEnforcementAgenciesObligation'\r\n\tconst eventType = isVariationPresent ? 35 : 12\r\n\t\r\n\tconst baseCharge = parseFloat(obdata[\"Reduced_Charge\"].replace(/\\$/g, '')) \r\n\t\t+ parseFloat(obdata[\"Court_Fine\"].replace(/\\$/g, ''))\r\n\t\t+ parseFloat(obdata[\"Court_Costs\"].replace(/\\$/g, ''))  \r\n\r\n\tconst amountFee = parseFloat(obdata[\"Penalty_Reminder_Fee\"].replace(/\\$/g, '')) \r\n\t\t+ parseFloat(obdata[\"Registration_Fee\"].replace(/\\$/g, '')) \r\n\t\t+ parseFloat(obdata[\"Enforcement_Fee\"].replace(/\\$/g, '')) \r\n\t\t+ parseFloat(obdata[\"Warrant_Issue_Fee\"].replace(/\\$/g, '')) \r\n\t\t+ parseFloat(obdata[\"Amount_Waived\"].replace(/\\$/g, '')) \r\n\t\t\r\n\r\n\tconst amountDueAndFee = (amountFee + baseCharge).toString()\r\n\r\n\tlet body = [{\r\n\t\t\"commandTimeStamp\": dateISO,\r\n\t\t\"eventType\": eventType,\r\n\t\t[commandType]: {\r\n\t\t\t\"aggregateId\": aggregateId,\r\n\t\t\t\"commandEventType\": eventType,\r\n\t\t\t\"commandTimeStamp\": dateISO,\r\n\t\t\t\"latestTimeStamp\": dateISO,\r\n\t\t\t[sequence]: {\r\n\t\t\t\t\"debtorID\": obdata.DebtorID,\r\n\t\t\t\t\"debtorDateOfBirth\": DateofBirth,\r\n\t\t\t\t\"infringementNumber\": obdata.Infringement,\r\n\t\t\t\t\"infringementNoticeIssueDate\": DateofIssue,\r\n\t\t\t\t\"issuingAgency\": obdata.issuingAgency,\r\n\t\t\t\t\"infringementIndicator\":\r\n\t\t\t\t\tobStatus[Obligation] === \"NFDP\" ? \"NFD\" :\r\n\t\t\t\t\t\t(obStatus[Obligation] === \"CHLGLOG\" || obStatus[Obligation] === \"PAID\") && parseInt(obdata[\"Warrant_Issue_Fee\"].replace(/\\$/g, '')) > 0 ? \"EW\" :\r\n\t\t\t\t\t\t\t(obStatus[Obligation] === \"CHLGLOG\" || obStatus[Obligation] === \"PAID\") && parseInt(obdata[\"Enforcement_Fee\"].replace(/\\$/g, '')) > 0 ? \"NFD\" :\r\n\t\t\t\t\t\t\t\t(obStatus[Obligation] === \"CHLGLOG\" || obStatus[Obligation] === \"PAID\") && parseInt(obdata[\"Penalty_Reminder_Fee\"].replace(/\\$/g, '')) > 0 ? \"PRN\" :\r\n\t\t\t\t\t\t\t\t\t(obStatus[Obligation] === \"CHLGLOG\" || obStatus[Obligation] === \"PAID\") && parseInt(obdata[\"Penalty_Reminder_Fee\"].replace(/\\$/g, '')) === 0 ? \"I\" :\r\n\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"SELENF\" ? \"PRN\" :\r\n\t\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"SELDEA\" ? \"NFD\" :\r\n\t\t\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"WARRNT\" ? \"EW\" :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"INF\" ? \"I\" :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"INFP\" ? \"I\" :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"PRN\" ? \"PRN\" :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tobStatus[Obligation] === \"PRNP\" ? \"PRN\" :\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\"NFD\",\r\n\t\t\t\t\"enforcementAgencyID\": obdata[\"enforcementAgencyID\"],\r\n\t\t\t\t\"enforcementAgencyCode\": obdata[\"enforcementAgencyCode\"],\r\n\t\t\t\t\"offenceCode\": obdata[\"Offence_Code\"],\r\n\t\t\t\t\"offenceCodeDescription\": obdata[\"Offence_Description\"],\r\n\t\t\t\t\"enforcementAgencyName\": obdata[\"Agency\"],\r\n\t\t\t\t\"offenceStreetSuburb\": obdata[\"Offence Location\"],\r\n\t\t\t\t\"offenceStreetandSuburb\": obdata[\"Offence Location\"],\r\n\t\t\t\t\"offenceDateTime\": DateofOffence,\r\n\t\t\t\t\"registrationStatePlate\": obdata[\"Driver License State\"] + \" \" + obdata[\"VRM Number\"],\r\n\t\t\t\t\"amountDueAndFee\": amountDueAndFee, // Total Amount Owing\r\n\t\t\t\t\"amountDue\": baseCharge, // Original penalty amount\r\n\t\t\t\t\"amountFee\": amountFee, // All fees\r\n\t\t\t\t\"debtorName\": fulldata.First_Name + \" \" + fulldata.Last_Name,\r\n\t\t\t\t\"debtorAddressLine1\": fulldata.Address_1,\r\n\t\t\t\t\"debtorAddressSuburb\": fulldata.Town,\r\n\t\t\t\t\"debtorAddressState\": fulldata.State,\r\n\t\t\t\t\"debtorAddressPostCode\": fulldata.Post_Code,\r\n\t\t\t\t\"debtorLicenceState\": obdata[\"Driver License State\"] + \" \" + obdata[\"Driver License No.\"],\r\n\t\t\t\t\"wdpHoldStatusID\": parseInt(obdata[\"Balance_Outstanding\"].replace(/\\$/g, '')) <= 0 || obStatus[Obligation] === \"CHLGLOG\" || obStatus[Obligation] === \"PAID\" || obStatus[Obligation] === \"CANCL\" ? 97 : 96,\r\n\t\t\t\t\"eligibility\": parseInt(obdata[\"Balance_Outstanding\"].replace(/\\$/g, '')) <= 0 || obStatus[Obligation] === \"CHLGLOG\" || obStatus[Obligation] === \"PAID\" || obStatus[Obligation] === \"CANCL\" ? \"INELIGIBLE\" : \"ELIGIBLE\",\r\n\t\t\t\t\"workedOffAmount\": 0,\r\n\t\t\t\t\"manualAdjustmentAmount\": Math.abs(parseFloat(obdata['Amount_Paid'].replace(/\\$/g, '')))\r\n\t\t\t}\r\n\t\t}\r\n\t}]\r\n\r\n\tif (isVariationPresent) {\r\n\t\tbody[0].addObligationToWDPVariationCommand[\"wdpVariationID\"] = 6\r\n\t}\r\n\tif (isVariationPresent) {\r\n\t\tbody[0].addObligationToWDPVariationCommand[\"obligation\"][\"obligationNumber\"] = obdata.Obligation\r\n\t}\r\n\r\n\tbody = JSON.stringify(body)\r\n\r\n\tapiUrl = location.hostname === \"uat.wdp.vic.gov.au\" ? \"uatapi\" :\r\n\t\tlocation.hostname === \"uat2.wdp.vic.gov.au\" ? \"uat2api\" :\r\n\t\t\t\"api\";\r\n\r\n\tlet data = fetch(\"https://\" + apiUrl + \".wdp.vic.gov.au/api/WorkDevelopmentPermit/SubmitListOfCommands\", {\r\n\t\t// \"credentials\": \"include\",\r\n\t\t\"headers\": {\r\n\t\t\t\"accept\": \"application/json; charset=UTF-8\",\r\n\t\t\t\"authorization\": find_str(Object.entries(localStorage)),\r\n\t\t\t\"cache-control\": \"no-cache\",\r\n\t\t\t\"content-type\": \"application/json; charset=UTF-8\",\r\n\t\t\t\"expires\": \"-1\",\r\n\t\t\t\"pragma\": \"no-cache\"\r\n\t\t},\r\n\t\t\"referrer\": \"https://\" + location.hostname + \"/wdp-applications/external-enforcement-agencies-list?filter=submitted\",\r\n\t\t\"referrerPolicy\": \"strict-origin-when-cross-origin\",\r\n\t\t\"body\": body,\r\n\t\t\"method\": \"POST\",\r\n\t\t\"mode\": \"cors\"\r\n\t});\r\n\treturn data;\r\n}\r\n\r\nchrome.storage.onChanged.addListener(function (changes, namespace) {\r\n\tfor (var key in changes) {\r\n\t\tchrome.storage.local.get(['obligationsCountFixed'], function (items) {\r\n\t\t\tif (changes.obligationsCount !== undefined) {\r\n\t\t\t\tlet progress = Math.ceil(100 - (changes.obligationsCount.newValue - 1) / items.obligationsCountFixed * 100)\r\n\t\t\t\twaitingDialog.progress(progress, 100);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n})\r\n\r\n\r\nfunction batchRequests(obdata, fulldata, obStatus) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tvar results = [];\r\n\r\n\t\tvar index = 0;\r\n\t\tfunction next() {\r\n\t\t\tif (index < obdata.length) {\r\n\t\t\t\tPromise.all(obdata[index++].map(ob => { return submitToWDP(ob, fulldata, obStatus) })).then(function (data) {\r\n\t\t\t\t\tresults.push(data);\r\n\t\t\t\t\tsetTimeout(function () { next() }, 1000);\r\n\t\t\t\t}, reject);\r\n\t\t\t} else {\r\n\t\t\t\tresolve(results);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\t\t// start first iteration\r\n\t\tnext();\r\n\t});\r\n}\r\n\r\nasync function getCurrentWDPInfringements(appNumber) {\r\n\r\n\tapiUrl = location.hostname === \"uat.wdp.vic.gov.au\" ? \"uatapi\" :\r\n\t\tlocation.hostname === \"uat2.wdp.vic.gov.au\" ? \"uat2api\" :\r\n\t\t\t\"api\";\r\n\r\n\tlet res = await fetchResource(\"https://\" + apiUrl + \".wdp.vic.gov.au/api/WorkDevelopmentPermit/\" + appNumber, {\r\n\t\t\"credentials\": \"include\",\r\n\t\t\"headers\": {\r\n\t\t\t\"accept\": \"application/json; charset=UTF-8\",\r\n\t\t\t\"authorization\": find_str(Object.entries(localStorage)),\r\n\t\t\t\"cache-control\": \"no-cache\",\r\n\t\t\t\"content-type\": \"application/json\",\r\n\t\t\t\"expires\": \"-1\",\r\n\t\t\t\"pragma\": \"no-cache\"\r\n\t\t},\r\n\t\t\"referrer\": \"https://\" + location.hostname + \"/wdp-applications/app-wdp-list?filter=inProgress\",\r\n\t\t\"referrerPolicy\": \"no-referrer-when-downgrade\",\r\n\t\t\"body\": null,\r\n\t\t\"method\": \"GET\",\r\n\t\t\"mode\": \"cors\"\r\n\t});\r\n\r\n\tlet jsonData = await res.json();\r\n\tlet infringementNumbers = [];\r\n\tjsonData.externalEnforcementAgenciesObligations.map(ob => { infringementNumbers.push(ob.infringementNumber) });\r\n\treturn infringementNumbers\r\n}\r\n\r\nfunction fetchResource(input, init) {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tchrome.runtime.sendMessage({ input, init }, messageResponse => {\r\n\t\t\tconst [response, error] = messageResponse;\r\n\t\t\tif (response === null) {\r\n\t\t\t\treject(error);\r\n\t\t\t} else {\r\n\t\t\t\t// Use undefined on a 204 - No Content\r\n\t\t\t\tconst body = response.body ? new Blob([response.body]) : undefined;\r\n\t\t\t\tresolve(new Response(body, {\r\n\t\t\t\t\tstatus: response.status,\r\n\t\t\t\t\tstatusText: response.statusText,\r\n\t\t\t\t}));\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\nfunction addStyleString(str) {\r\n\tvar node = document.createElement('style');\r\n\tnode.innerHTML = str;\r\n\tdocument.body.appendChild(node);\r\n}\r\n\r\naddStyleString(`.lds-ring {\r\n\tdisplay: block;\r\n\tposition: relative;\r\n\twidth: 80px;\r\n\theight: 80px;\r\n\tmargin: auto;\r\n  }\r\n  .lds-ring div {\r\n\tbox-sizing: border-box;\r\n\tdisplay: block;\r\n\tposition: absolute;\r\n\twidth: 64px;\r\n\theight: 64px;\r\n\tmargin: auto;\r\n\tborder: 8px solid #e7e7e7;\r\n\tborder-radius: 50%;\r\n\tanimation: lds-ring 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;\r\n\tborder-color: #e7e7e7 transparent transparent transparent;\r\n\tdisplay: flex;\r\n\talign-items: center\r\n  }\r\n  .lds-ring div:nth-child(1) {\r\n\tanimation-delay: -0.45s;\r\n  }\r\n  .lds-ring div:nth-child(2) {\r\n\tanimation-delay: -0.3s;\r\n  }\r\n  .lds-ring div:nth-child(3) {\r\n\tanimation-delay: -0.15s;\r\n  }\r\n  @keyframes lds-ring {\r\n\t0% {\r\n\t  transform: rotate(0deg);\r\n\t}\r\n\t100% {\r\n\t  transform: rotate(360deg);\r\n\t}\r\n  }\r\n  `);\n\n//# sourceURL=webpack://Toolkit-for-VIEW/./src/js/WDPAutomator.js?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = {};
/******/ 	__webpack_modules__["./src/js/WDPAutomator.js"]();
/******/ 	
/******/ })()
;